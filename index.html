<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>ourlittleforever</title>

  <style>
    :root{
      /* theme */
      --bg-dark:#050608;
      --ink:#2b1f16;             /* deep brown-black */
      --pink:#ff6fb0;
      --pink2:#ff4fa3;
      --cream:#f6f3ea;           /* kiss.gif vibe */
      --glass:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.10);

      /* typography */
      --serif: ui-serif, "Iowan Old Style","Palatino Linotype",Palatino,"Times New Roman",serif;
      --sans: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      overflow:hidden; /* no scroll, so NO won't run ‚Äúoutside page‚Äù */
      background: radial-gradient(1200px 900px at 70% -10%, rgba(255,111,176,.10), transparent 55%),
                  radial-gradient(900px 700px at 15% 110%, rgba(255,111,176,.08), transparent 55%),
                  var(--bg-dark);
      color:#fff;
      font-family: var(--sans);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: manipulation;
    }

    /* floating outline hearts watermark */
    .wm-hearts{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:0;
      overflow:hidden;
    }
    .wm-hearts .h{
      position:absolute;
      width:28px; height:28px;
      opacity:.14;
      filter: blur(.1px);
      animation: floatUp linear forwards;
    }
    .wm-hearts .h svg{
      width:100%; height:100%;
      fill:none;
      stroke: rgba(255,111,176,.75);
      stroke-width:2.2;
      stroke-linecap:round;
      stroke-linejoin:round;
    }
    @keyframes floatUp{
      from{ transform: translateY(14vh) scale(.9); opacity:.0; }
      10%{ opacity:.14; }
      to{ transform: translateY(-120vh) scale(1.12); opacity:0; }
    }

    /* main stage */
    .wrap{
      position:relative;
      z-index:2;
      height:100%;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:
        calc(18px + env(safe-area-inset-top))
        calc(18px + env(safe-area-inset-right))
        calc(18px + env(safe-area-inset-bottom))
        calc(18px + env(safe-area-inset-left));
    }

    .card{
      width:min(940px, 100%);
      height:min(620px, 100%);
      border-radius:26px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 28px 90px rgba(0,0,0,.55);
      padding: clamp(20px, 3.2vw, 40px);
      position:relative;
      overflow:hidden;
    }

    /* success page becomes cream */
    body.success-mode{
      background: var(--cream);
      color: var(--ink);
    }
    body.success-mode .card{
      background: var(--cream);
      border:1px solid rgba(43,31,22,.10);
      box-shadow: 0 26px 80px rgba(0,0,0,.18);
    }

    /* intro */
    .intro{
      height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:22px;
      text-align:center;
    }
    .big-hello{
      font-family: var(--serif);
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.06;
      color: rgba(43,31,22,.11);
      position:absolute;
      inset:auto 0 auto 0;
      top: 22%;
      transform: translateY(-50%);
      font-size: clamp(44px, 7vw, 86px);
      pointer-events:none;
      user-select:none;
    }
    .rotator{
      font-family: var(--serif);
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.06;
      color: var(--ink);
      font-size: clamp(40px, 6vw, 82px);
      margin-top: clamp(18px, 2vw, 26px);
    }
    .sub{
      color: var(--pink);
      font-family: var(--sans);
      font-size: 18px;
      letter-spacing:.12em;
      text-transform: lowercase;
      margin-top:-8px;
    }

    .startRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .gifStart{
      width: 76px; height: 76px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius: 18px;
      background: transparent; /* let it be clean */
      overflow:hidden;
    }
    .gifStart img{
      width:76px; height:76px;
      object-fit:contain;
      display:block;
    }

    .btn{
      border:0;
      border-radius: 999px;
      padding: 16px 26px;
      font-weight: 700;
      letter-spacing: .18em;
      text-transform: uppercase;
      cursor:pointer;
      transition: transform .08s ease, opacity .15s ease;
      user-select:none;
    }
    .btn:active{ transform: scale(.98); }
    .btn-dark{
      background:#1a120d;
      color:#fff;
      box-shadow: 0 12px 32px rgba(0,0,0,.28);
    }
    .btn-pink{
      background: linear-gradient(90deg, var(--pink), var(--pink2));
      color:#24130d;
      box-shadow: 0 12px 38px rgba(255,111,176,.24);
    }
    .btn-ghost{
      background: rgba(255,255,255,.02);
      color:#fff;
      border:1px solid rgba(255,255,255,.12);
    }

    /* question pages */
    .q{
      height:100%;
      display:none;
      align-items:center;
      justify-content:center;
      text-align:center;
      position:relative;
    }
    .q.active{ display:flex; }

    .qInner{
      width:min(680px, 96%);
      margin:0 auto;
      position:relative;
      z-index:3;
    }

    .miniTop{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-bottom:10px;
      min-height: 18px;
      font-family: var(--sans);
      font-size: 12px;
      letter-spacing:.28em;
      text-transform: uppercase;
      opacity:.75;
    }

    .topHeart{
      width:18px;height:18px;
      display:inline-block;
    }
    .topHeart svg{
      width:100%;height:100%;
      fill:none;
      stroke: rgba(255,111,176,.9);
      stroke-width:2.4;
      stroke-linecap:round;
      stroke-linejoin:round;
    }

    .qNum{
      font-family: var(--sans);
      font-size: 12px;
      letter-spacing:.35em;
      opacity:.45;
      margin-bottom:10px;
    }
    .qTitle{
      font-family: var(--serif);
      font-weight: 700;
      letter-spacing:-0.02em;
      line-height:1.12;
      font-size: clamp(34px, 4.2vw, 56px);
      margin: 0 0 10px 0;
    }
    .qSub{
      font-size: 14px;
      letter-spacing:.10em;
      opacity:.55;
      margin: 0 0 26px 0;
    }

    .actions{
      display:flex;
      justify-content:center;
      gap:14px;
      flex-wrap:wrap;
      position:relative;
      z-index:4;
    }
    .pill{
      min-width: 170px;
      padding: 14px 18px;
      border-radius: 999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      letter-spacing:.18em;
      text-transform: uppercase;
      font-weight: 800;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.02);
      color:#fff;
      cursor:pointer;
      user-select:none;
    }
    .pill.pink{
      background: linear-gradient(90deg, var(--pink), var(--pink2));
      border:0;
      color:#2b1f16;
      box-shadow: 0 14px 40px rgba(255,111,176,.18);
    }
    .pill .smallHeart{
      width:14px;height:14px;
      display:inline-block;
    }
    .pill .smallHeart svg{
      width:100%;height:100%;
      fill:none;
      stroke: rgba(43,31,22,.85);
      stroke-width:2.2;
      stroke-linecap:round;
      stroke-linejoin:round;
    }

    /* last question NO button (fixed in viewport, never disappears, never goes out) */
    .noFixed{
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999; /* always on top */
      display:none;
      pointer-events:auto;
    }
    .noFixed.show{ display:block; }

    .noBtn{
      min-width: 140px;
      padding: 14px 18px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.03);
      color:#fff;
      font-weight:800;
      letter-spacing:.18em;
      text-transform: uppercase;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: 0 12px 34px rgba(0,0,0,.25);
      touch-action: manipulation;
    }

    /* progress dots */
    .dots{
      position:absolute;
      left:50%;
      bottom: 18px;
      transform: translateX(-50%);
      display:flex;
      gap:8px;
      opacity:.65;
      z-index:5;
    }
    .dot{
      width:6px;height:6px;border-radius:999px;
      background: rgba(255,255,255,.22);
    }
    .dot.on{
      width:22px;
      background: linear-gradient(90deg, var(--pink), var(--pink2));
    }

    /* success */
    .success{
      height:100%;
      display:none;
      align-items:center;
      justify-content:center;
      text-align:center;
      position:relative;
    }
    .success.active{ display:flex; }
    .sInner{
      width:min(720px, 96%);
      margin:0 auto;
      position:relative;
      z-index:3;
      color: var(--ink);
    }
    .sTitle{
      font-family: var(--serif);
      font-weight: 800;
      letter-spacing: -0.02em;
      font-size: clamp(44px, 7vw, 72px);
      margin: 0 0 8px 0;
      color: var(--ink);
    }
    .sSub{
      margin: 0 0 22px 0;
      color: rgba(43,31,22,.62);
      font-size: 14px;
      letter-spacing:.06em;
    }
    .gifBox{
      width: min(340px, 78vw);
      aspect-ratio: 1 / 1;
      margin: 0 auto 18px;
      border-radius: 22px;
      background: var(--cream); /* match the gif vibe */
      border: 0;               /* remove frame */
      box-shadow: none;        /* remove frame */
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .gifBox img{
      width: 92%;
      height: 92%;
      object-fit: contain;
      display:block;
      background: transparent;
    }
    .finalTitle{
      font-family: var(--serif);
      font-weight: 800;
      letter-spacing:-0.02em;
      font-size: clamp(28px, 4vw, 44px);
      margin: 8px 0 0 0;
      color: var(--ink);
    }

    /* party pop confetti: from bottom to top, slower */
    .confetti{
      position: fixed;
      inset:0;
      pointer-events:none;
      z-index: 2000;
      display:none;
      overflow:hidden;
    }
    .confetti.show{ display:block; }
    .confetti i{
      position:absolute;
      bottom: -20px;
      width: 10px;
      height: 18px;
      border-radius: 2px;
      background: rgba(255,255,255,.8);
      opacity:.9;
      animation: popUp 2.2s ease-out forwards;
      transform: translateY(0) rotate(0deg);
    }
    @keyframes popUp{
      0%{ transform: translateY(0) rotate(0deg); opacity:0; }
      8%{ opacity:.95; }
      100%{ transform: translateY(-115vh) rotate(360deg); opacity:0; }
    }

    /* make everything center on mobile */
    @media (max-width: 520px){
      .card{ border-radius:22px; }
      .pill{ min-width: 150px; }
      .gifStart{ width:64px;height:64px; }
      .gifStart img{ width:64px;height:64px; }
    }
  </style>
</head>

<body>
  <!-- watermark hearts background -->
  <div class="wm-hearts" id="wmHearts"></div>

  <div class="wrap">
    <div class="card" id="card">

      <!-- Intro -->
      <div class="intro" id="intro">
        <div class="big-hello">‰Ω†Â•Ω Kuo BaoPay</div>

        <div class="rotator" id="rotator">Hola Kuo BaoPay</div>
        <div class="sub">a little hello</div>

        <div class="startRow">
          <div class="gifStart" aria-hidden="true">
            <img src="start.gif" alt="" />
          </div>
          <button class="btn btn-dark" id="startBtn">LET‚ÄôS START</button>
        </div>
      </div>

      <!-- Questions (1~4) -->
      <div class="q" id="q1">
        <div class="qInner" id="q1Inner">
          <div class="miniTop">
            <span class="topHeart" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
            </span>
          </div>
          <div class="qNum">01</div>
          <h2 class="qTitle">Do you like spending time<br/>with me?</h2>
          <p class="qSub">be honest‚Ä¶</p>
          <div class="actions">
            <button class="pill pink" data-next="q2">
              YES
              <span class="smallHeart" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
              </span>
            </button>
            <button class="pill" data-next="q2">ABSOLUTELY</button>
          </div>
        </div>
        <div class="dots">
          <span class="dot on"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
      </div>

      <div class="q" id="q2">
        <div class="qInner" id="q2Inner">
          <div class="miniTop">
            <span class="topHeart" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
            </span>
          </div>
          <div class="qNum">02</div>
          <h2 class="qTitle">Do you think about me<br/>when we‚Äôre apart?</h2>
          <p class="qSub">even a little?</p>
          <div class="actions">
            <button class="pill pink" data-next="q3">
              YES
              <span class="smallHeart" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
              </span>
            </button>
            <button class="pill" data-next="q3">ABSOLUTELY</button>
          </div>
        </div>
        <div class="dots">
          <span class="dot"></span><span class="dot on"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
      </div>

      <div class="q" id="q3">
        <div class="qInner" id="q3Inner">
          <div class="miniTop">
            <span class="topHeart" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
            </span>
          </div>
          <div class="qNum">03</div>
          <h2 class="qTitle">Do you smile when you see<br/>my name on your phone?</h2>
          <p class="qSub">because I smile when I see yours‚Ä¶</p>
          <div class="actions">
            <button class="pill pink" data-next="q4">
              YES
              <span class="smallHeart" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
              </span>
            </button>
            <button class="pill" data-next="q4">ABSOLUTELY</button>
          </div>
        </div>
        <div class="dots">
          <span class="dot"></span><span class="dot"></span><span class="dot on"></span><span class="dot"></span><span class="dot"></span>
        </div>
      </div>

      <div class="q" id="q4">
        <div class="qInner" id="q4Inner">
          <div class="miniTop" id="lastTop">
            <!-- starts as heart, becomes ARE YOU SURE? üò° and stays until YES -->
            <span class="topHeart" id="topHeartEl" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
            </span>
            <span id="areYouSureText" style="display:none;">ARE YOU SURE? üò°</span>
          </div>

          <div class="qNum">04</div>
          <div style="font-family:var(--sans); font-size:11px; letter-spacing:.34em; opacity:.55; margin-bottom:8px;">
            THE REAL QUESTION
          </div>
          <h2 class="qTitle">Will you be<br/><span style="color:var(--pink);">my Valentine?</span></h2>
          <p class="qSub">i‚Äôve been waiting to ask you this‚Ä¶</p>

          <div class="actions" id="lastActions">
            <button class="pill pink" id="finalYes">
              YES, I‚ÄôD LOVE TO
              <span class="smallHeart" aria-hidden="true">
                <svg viewBox="0 0 24 24"><path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/></svg>
              </span>
            </button>
          </div>
        </div>

        <div class="dots">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot on"></span><span class="dot"></span>
        </div>
      </div>

      <!-- The NO button that runs around (fixed to viewport) -->
      <div class="noFixed" id="noFixed">
        <button class="noBtn" id="noBtn">NO</button>
      </div>

      <!-- Success -->
      <div class="success" id="success">
        <div class="sInner">
          <div class="topHeart" style="margin:0 auto 10px; width:18px; height:18px; opacity:.9;">
            <svg viewBox="0 0 24 24" style="width:100%;height:100%;fill:none;stroke:rgba(255,111,176,.9);stroke-width:2.4;stroke-linecap:round;stroke-linejoin:round;">
              <path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/>
            </svg>
          </div>

          <h1 class="sTitle">Yaaay!</h1>
          <p class="sSub">I knew you‚Äôd say yes.<br/>You just made me the happiest person in the world.</p>

          <div class="gifBox" id="gifBox">
            <img src="kiss.gif" alt="kiss" />
          </div>

          <div class="finalTitle">Happy Valentine‚Äôs and 18th</div>
        </div>
      </div>

    </div>
  </div>

  <!-- confetti -->
  <div class="confetti" id="confetti"></div>

  <!-- audio (will start only after user gesture) -->
  <audio id="bgm" src="bgm.mp3" preload="auto" loop></audio>
  <audio id="pop" src="pop.mp3" preload="auto"></audio>

  <script>
    /* ---------- helpers ---------- */
    const $ = (id)=>document.getElementById(id);

    function show(id){
      ["intro","q1","q2","q3","q4","success"].forEach(k=>{
        const el=$(k);
        if(!el) return;
        el.classList.toggle("active", k===id);
        if(k==="intro") el.style.display = (k===id) ? "flex" : "none";
      });
      if(id==="intro"){ $("intro").style.display="flex"; }
      if(id!=="intro"){ $("intro").style.display="none"; }
    }

    /* ---------- language rotator ---------- */
    const helloList = [
      "Hola Kuo BaoPay",
      "Bonjour Kuo BaoPay",
      "‰Ω†Â•Ω Kuo BaoPay",
      "„Åì„Çì„Å´„Å°„ÅØ Kuo BaoPay",
      "ÂìàÂõâ Kuo BaoPay"
    ];
    let helloIdx=0;
    setInterval(()=>{
      const el=$("rotator");
      if(!el) return;
      helloIdx=(helloIdx+1)%helloList.length;
      el.style.opacity=0;
      setTimeout(()=>{
        el.textContent = helloList[helloIdx];
        el.style.opacity=1;
      },180);
    },1800);

    /* ---------- watermark hearts generator ---------- */
    function heartSVG(){
      return `
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 21s-7-4.4-9.4-8.5C.9 9.2 2.2 6.6 4.7 6c1.6-.4 3 .2 4 1.5.9-1.3 2.4-1.9 4-1.5 2.5.6 3.8 3.2 2.1 6.5C19 16.6 12 21 12 21z"/>
        </svg>
      `;
    }
    function spawnWM(){
      const host=$("wmHearts");
      const h=document.createElement("div");
      h.className="h";
      h.innerHTML = heartSVG();
      const size = 18 + Math.random()*26;
      h.style.width = size+"px";
      h.style.height = size+"px";
      h.style.left = (Math.random()*100)+"vw";
      h.style.bottom = (-10 - Math.random()*30)+"vh";
      const dur = 12 + Math.random()*16; // slow
      h.style.animationDuration = dur+"s";
      h.style.opacity = (0.08 + Math.random()*0.10).toFixed(2);
      host.appendChild(h);
      setTimeout(()=>h.remove(), dur*1000 + 500);
    }
    // continuous
    setInterval(spawnWM, 420);

    /* ---------- navigation / clicks ---------- */
    const bgm = $("bgm");
    const pop = $("pop");

    $("startBtn").addEventListener("click", async ()=>{
      // user gesture: start BGM safely on iOS
      try{ await bgm.play(); }catch(e){}
      show("q1");
      $("q1").classList.add("active");
      // hide NO button until last question
      $("noFixed").classList.remove("show");
    });

    document.querySelectorAll("[data-next]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const next = btn.getAttribute("data-next");
        show(next);
        // if entering q4, place NO next to YES initially
        if(next==="q4"){
          placeNoNextToYes();
          $("noFixed").classList.add("show");
        }
      });
    });

    /* ---------- last question behavior ---------- */
    let noActivated = false;

    function setAreYouSure(on){
      const heart = $("topHeartEl");
      const txt = $("areYouSureText");
      if(on){
        heart.style.display="none";
        txt.style.display="inline";
      }else{
        txt.style.display="none";
        heart.style.display="inline";
      }
    }

    function placeNoNextToYes(){
      // put NO next to YES (right side) inside viewport
      const yesBtn = $("finalYes");
      const noWrap = $("noFixed");
      const rect = yesBtn.getBoundingClientRect();

      const pad = 10;
      let x = rect.right + 16;
      let y = rect.top + rect.height/2;

      // clamp to viewport
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const noBtn = $("noBtn");
      noWrap.classList.add("show");
      // temp center to measure
      noWrap.style.left = "50%";
      noWrap.style.top = "50%";
      noWrap.style.transform = "translate(-50%, -50%)";
      const nb = noBtn.getBoundingClientRect();

      x = Math.min(vw - nb.width/2 - pad, Math.max(nb.width/2 + pad, x + nb.width/2));
      y = Math.min(vh - nb.height/2 - pad, Math.max(nb.height/2 + pad, y));

      noWrap.style.left = x + "px";
      noWrap.style.top  = y + "px";
      noWrap.style.transform = "translate(-50%, -50%)";
    }

    function randomNoPositionAvoidText(){
      const noWrap = $("noFixed");
      const noBtn = $("noBtn");
      const pad = 12;

      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const forbidden = $("q4Inner").getBoundingClientRect(); // avoid overlapping the whole content block

      // measure no button
      const nb = noBtn.getBoundingClientRect();
      const w = nb.width, h = nb.height;

      // try multiple times to find a spot not overlapping forbidden
      for(let i=0;i<30;i++){
        const x = pad + w/2 + Math.random()*(vw - w - pad*2);
        const y = pad + h/2 + Math.random()*(vh - h - pad*2);

        const box = { left:x-w/2, top:y-h/2, right:x+w/2, bottom:y+h/2 };
        const overlaps =
          !(box.right < forbidden.left || box.left > forbidden.right ||
            box.bottom < forbidden.top || box.top > forbidden.bottom);

        if(!overlaps){
          noWrap.style.left = x+"px";
          noWrap.style.top  = y+"px";
          noWrap.style.transform="translate(-50%, -50%)";
          return;
        }
      }

      // fallback: clamp bottom-left corner area
      noWrap.style.left = (pad + w/2)+"px";
      noWrap.style.top  = (vh - pad - h/2)+"px";
      noWrap.style.transform="translate(-50%, -50%)";
    }

    // keep NO always visible; only starts running after first NO tap (or touchstart)
    function activateNoRun(){
      if(noActivated) return;
      noActivated = true;
      setAreYouSure(true);   // stays until YES

      // on iOS: use touchstart to be snappy and to prevent "double tap disappears" issues
      randomNoPositionAvoidText();
    }

    $("noBtn").addEventListener("click", (e)=>{
      e.preventDefault();
      e.stopPropagation();
      activateNoRun();
      randomNoPositionAvoidText();
    }, {passive:false});

    $("noBtn").addEventListener("touchstart", (e)=>{
      e.preventDefault();
      e.stopPropagation();
      activateNoRun();
      randomNoPositionAvoidText();
    }, {passive:false});

    // also keep NO in safe place on resize/orientation
    window.addEventListener("resize", ()=>{
      if($("q4").classList.contains("active")){
        if(noActivated) randomNoPositionAvoidText();
        else placeNoNextToYes();
      }
    });

    // YES final
    $("finalYes").addEventListener("click", async ()=>{
      // return heart (and hide are you sure)
      setAreYouSure(false);

      // stop NO running + hide NO
      $("noFixed").classList.remove("show");

      // play pop sfx
      try{
        pop.currentTime = 0;
        await pop.play();
      }catch(e){}

      // switch to success mode
      document.body.classList.add("success-mode");
      show("success");
      $("success").classList.add("active");

      // confetti pop upward (slower, party pop)
      burstConfetti();

      // keep bgm (already playing); if not started for some reason, try
      try{ if(bgm.paused) await bgm.play(); }catch(e){}
    });

    /* ---------- confetti (from bottom to top) ---------- */
    function burstConfetti(){
      const host = $("confetti");
      host.innerHTML = "";
      host.classList.add("show");

      const colors = [
        "rgba(255,111,176,.95)",
        "rgba(255,255,255,.90)",
        "rgba(255,195,224,.92)"
      ];

      const count = 90;
      for(let i=0;i<count;i++){
        const p=document.createElement("i");
        const left = Math.random()*100;
        p.style.left = left+"vw";
        p.style.background = colors[Math.floor(Math.random()*colors.length)];
        p.style.animationDelay = (Math.random()*0.25)+"s";
        p.style.animationDuration = (2.1 + Math.random()*0.7)+"s";
        p.style.width = (7 + Math.random()*7)+"px";
        p.style.height = (12 + Math.random()*16)+"px";
        host.appendChild(p);
      }

      setTimeout(()=>host.classList.remove("show"), 3300);
    }

    /* ---------- initial state ---------- */
    show("intro");
    // hide NO wrapper initially
    $("noFixed").classList.remove("show");
  </script>
</body>
</html>
